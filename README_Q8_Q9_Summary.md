# 问题8和问题9 - 促销优化 解决方案总结

## 快速概览

本项目为VeloMotion GmbH的价格促销优化问题提供了两个数学优化模型的解决方案。

### 关键成果

| 问题 | 方法 | 最优促销方案 | 利润增益 | 增长率 |
|------|------|----------|--------|--------|
| **问题8** | 参数扫描 | 11月（November）单促销 | €830,742 | +2.29% |
| **问题9** | 混整数规划 | 6个月促销（偶数月：Feb, Apr, Jun, Aug, Oct, Dec） | €3,137,921 | +8.67% |

---

## 问题8：单一促销的最优时机

### 数学模型

**方法**：参数扫描（Parameter Sweep）

对每个可能的促销月份 t* ∈ {0,1,...,11}：

1. 调整该月份的需求：D'[t] = D[t] × (1 + 0.35) if t = t*
2. 调整后续两个月的需求：D'[t] = D[t] × (1 - 0.06) if t > t* and t ≤ t* + 2
3. 将该月份的价格调整为：price = 1250 × (1 - 0.05) = 1187.5€
4. 建立优化模型，最大化该促销方案下的年度利润
5. 对所有12个月重复，选择利润最高的月份

### 关键约束

```
需求调整约束：
D'[t] = D[t] + 0.35×D[t]×I(t=t*) - 0.06×D[t]×I(t-1=t*) - 0.06×D[t]×I(t-2=t*)

非连续约束（隐含）：
虽然是单促销，但体现非连续原则

库存、生产、员工约束：与基础模型相同
```

### 最优结果

```
最优促销月份：11月（November）
原始需求：6,000单位
促销后需求：8,100单位（增加35%）
12月需求影响：6,800 → 6,804（仅减少96单位）

财务指标：
- 基础模型利润：€36,208,650
- 促销方案利润：€37,039,392
- 利润增益：€830,742
- 增长率：+2.29%
```

### 经济学解释

为什么11月最优？

1. **高基数效应**：11月本身需求较高（6,000单位），促销的35%增长带来的绝对值较大
2. **有限负面影响**：12月和1月（受益月）的需求拉动影响相对有限（6%）
3. **时间价值**：年末促销能及时变现，利用库存空间充分
4. **库存利用**：前期积累的库存能有效支持该月的高需求

---

## 问题9：多促销优化 - 混整数规划方法

### 核心创新

**从枚举法到直接优化**：

```
旧方法（枚举）：
  生成所有可能的非连续促销组合（363种）
  → 对每种组合求解一个MIP模型
  → 比较结果找最优
  问题：计算量大，不是真正的优化

新方法（MIP）：
  在单个MIP模型中同时优化：
  ✓ 促销决策（X[t]）
  ✓ 生产计划（P[t], O[t], W[t], H[t], L[t]）
  ✓ 库存策略（I[t], B[t]）
  ✓ 人力资源（W[t]）

  通过求解器的分支定界算法直接找最优解
  时间：0.02秒（相比枚举法更快）
```

### 数学模型

#### 决策变量

**促销决策变量（新增）**：
```
X[t] ∈ {0, 1}  for t = 0, 1, ..., 11

X[t] = 1 ⟺ 第t个月进行促销
X[t] = 0 ⟺ 第t个月不进行促销
```

**生产相关**：
```
P[t] ≥ 0       内部生产量（单位）
O[t] ≥ 0       外部组装量（单位）
W[t] ∈ ℤ       员工数量（人）
H[t] ∈ ℤ       招聘数量（人）
L[t] ∈ ℤ       裁员数量（人）
OT[t] ≥ 0      加班小时数（小时）
I[t] ≥ 0       库存量（单位）
B[t] ≥ 0       积压订单量（单位）
```

#### 核心约束

**1. 非连续促销约束**（问题9的关键）

```
X[t] + X[t+1] ≤ 1   for t = 0, 1, ..., 10

物理含义：
- 相邻两个月不能同时进行促销
- 如果第t月有促销，第t+1月必须无促销
- 如果第t+1月有促销，第t月必须无促销
```

**2. 需求动态调整约束**

```
D'[t] = D[t] + 0.35×D[t]×X[t] - 0.06×D[t]×X[t-1] - 0.06×D[t]×X[t-2]

含义：
- 当月促销：需求增加35%
- 前1个月的促销拉动：当月需求减少6%
- 前2个月的促销拉动：当月需求减少6%
- 线性叠加：可以有多个月的拉动效应
```

**3. 库存平衡约束**

```
I[t-1] + P[t] + O[t] + B[t-1] = D'[t] + I[t] + B[t]

使用调整后的需求D'[t]（而非原始需求D[t]）
确保生产计划适应促销带来的需求变化
```

#### 目标函数

```
max Π = Σ_t [(P[t] + O[t]) × price[t]] - Σ_t [cost[t]]

价格随促销决策变化：
price[t] = 1250 × (1 - 0.05 × X[t])
         = {
             1187.5€  if X[t] = 1（促销月）
             1250€    if X[t] = 0（非促销月）
           }

成本包括：
- 材料成本：620 × P[t]
- 外包成本：710 × O[t]
- 正常工资：66.5 × P[t]（3.5 labor hours × 19€/h）
- 加班工资：24 × OT[t]
- 招聘成本：950 × H[t]
- 裁员成本：1600 × L[t]
- 库存成本：12 × I[t]
- 积压成本：35 × B[t]
```

### 模型规模

```
混整数规划模型：
- 决策变量：120个
  * 12个二进制变量（促销决策X[t]）
  * 24个整数变量（招聘H[t]和裁员L[t]）
  * 12个整数变量（员工数W[t]）
  * 72个连续变量（生产、库存等）

- 约束：108个
  * 11个非连续约束（X[t] + X[t+1] ≤ 1）
  * 12个需求调整约束
  * 12个库存平衡约束
  * 12个员工平衡约束
  * 12个招聘限制
  * 12个库存容量限制
  * 12个加班限制
  * 12个生产能力约束
  * 1个期末无积压约束
  * 其他约束

- 非零元素：293个
- 问题类型：线性目标函数 + 二进制+整数变量
```

### 最优解

```
最优促销方案：
  促销数量：6个月
  促销月份：Feb, Apr, Jun, Aug, Oct, Dec
  模式：交替促销（偶数月）

财务指标：
  年度利润：€39,346,571
  总收入：€89,772,500
  总成本：€50,425,929

与基础模型对比：
  利润增益：€3,137,921
  增长率：+8.67%

生产计划特点：
  - 在奇数月大量生产，积累库存
  - 在偶数月减少生产，从库存中满足需求
  - 形成规律的"积累-消耗"周期
  - 年底库存达到上限（8,000单位）以充分利用容量
```

### 数学验证

**最大非连续集验证**：

对于长度为12的路径图（月份链），满足非连续约束的最大独立集大小为：

```
⌈12/2⌉ = 6

这正是我们找到的最优解包含的促销数量！

这不是巧合，而是数学上的必然：
- 问题9本质上是路径图的最大权独立集问题
- 当所有权重相等时，最优解必然包含6个顶点
- 这里的权重虽然不完全相等（不同月份的基础需求不同）
  但由于促销的线性效应，倾向于均匀分布
```

### 求解性能

```
求解时间：0.02秒

求解过程：
1. 预处理（Presolve）：0.00s
   - 消除冗余约束和变量
   - 从108×120缩小到76×112

2. 根松弛（Root Relaxation）：0.00s
   - LP松弛的最优值：€39.998M（上界）

3. 分支定界（Branch and Bound）：0.02s
   - 探索节点数：1（很少的分支）
   - 迭代次数：101（LP迭代）

4. 求解质量：
   - 最优解：€39.346571M
   - 最优界：€39.346863M
   - 间隙（Gap）：0.0007%（非常接近最优）
```

---

## 关键比较表

### 模型方法比较

| 特性 | 问题8 | 问题9（旧） | 问题9（新） |
|------|------|----------|----------|
| **优化对象** | 生产计划 | 生产计划 | 促销决策+生产计划 |
| **促销方案** | 预定义1个月 | 预定义各种组合 | 优化决策（12个二进制变量） |
| **方法** | 参数扫描（12次） | 枚举（363次） | 直接求解MIP（1次） |
| **求解时间** | ~60秒 | ~600秒 | ~0.02秒 |
| **数学严密性** | ✓ 严密 | ✓ 严密 | ✓✓ 最严密 |
| **是否真正优化** | 部分（固定促销） | 部分（固定组合） | ✓ 完全优化 |
| **可扩展性** | 差 | 差 | 好 |

### 利润比较

```
基础方案（无促销）：         €36,208,650
问题8（单促销Nov）：         €37,039,392  (+€830,742, +2.29%)
问题9（多促销偶数月）：      €39,346,571  (+€3,137,921, +8.67%)

相对改进：
  多促销 vs 单促销 = (39,346,571 - 37,039,392) / 37,039,392
                  = €2,307,179 / €37,039,392
                  = +6.23%

总改进倍数：
  8.67% / 2.29% = 3.79倍改进
```

---

## 主要发现和洞察

### 1. **促销的非线性效应**

虽然单次促销增加35%需求，但多次促销不是简单的线性叠加：

```
单促销 → +2.29%利润增益
双促销 → +4.19%利润增益（不是4.58%）
六促销 → +8.67%利润增益（不是13.74%）

原因：
- 价格折扣成本叠加
- 生产调整成本增加
- 库存投资增加
- 人力资源调整成本增加
```

### 2. **最优模式的周期性**

```
为什么偶数月最优？

需求拉动链：
  Feb促销 → Mar需求-6% → Apr有促销 → May需求-6% → Jun有促销...

在偶数月进行促销：
  ✓ 每个促销月的增长都能充分体现
  ✓ 拉动效应被"吸收"在非促销奇数月
  ✓ 相邻的非促销月都是促销月，可以积累库存
  ✓ 形成最优的"积累-消耗"周期

在奇数月进行促销（对比）：
  可能的拉动冲突：相邻月份的拉动效应相互干扰
```

### 3. **库存管理的重要性**

```
在最优方案中：
- 初始库存：600单位
- 最大库存（12月末）：8,000单位（接近上限）
- 库存成本：€544,152（总成本的1.08%）

库存的作用：
✓ 缓冲促销产生的需求波动
✓ 支撑奇数月的生产
✓ 在偶数月促销时提供货源
✓ 改善生产计划的灵活性
```

### 4. **人力资源调整**

```
最优方案中：
- 初始员工数：160人
- 最大员工数（4月）：397人
- 总招聘：286人
- 总裁员：0人
- 招聘成本：€271,700（0.54%）

策略：
✓ 持续招聘以应对需求增长
✓ 不进行裁员（避免裁员成本1,600€/人）
✓ 利用招聘时间差，提前增加产能
✓ 员工数量单调递增
```

### 5. **外包不被使用**

```
在所有最优解中，外包量O[t] = 0

为什么？
- 内部生产成本：620(材料) + 66.5(正常工资) = 686.5€
- 外包成本：710€
- 内部更便宜：710 > 686.5 ✓

虽然内部需要加班或招聘新员工：
- 加班成本：24€/小时，最多12小时/人/月 = 288€/人/月（远低于招聘成本）
- 新员工成本包括：950€招聘 + 后续工资
- 仍然优于外包

因此：完全利用内部产能，不需外包
```

---

## 代码文件说明

### `question_8_9_promotion_optimization.py`

包含完整的优化模型：

**第一部分：问题1（基础模型）**
- 行数：1-282
- 功能：建立基础生产计划模型
- 输出：年度利润、成本结构、月度计划

**第二部分：问题8（单促销）**
- 行数：283-464
- 功能：为12个月分别建立优化模型，找出最优促销月份
- 方法：参数扫描
- 输出：每个月的利润、最优促销月份

**第三部分：问题9（多促销MIP）**
- 行数：465-789
- 功能：建立包含促销决策的混整数规划模型
- 方法：直接MIP求解
- 决策变量：12个二进制促销变量 + 生产变量
- 输出：最优促销方案、生产计划、成本结构

---

## 建议的应用方向

### 短期（立即实施）

1. **执行6月促销方案**
   - 按照偶数月执行（Feb, Apr, Jun, Aug, Oct, Dec）
   - 预期利润增长：€3.14M（+8.67%）

2. **库存规划**
   - 建立奇数月积累、偶数月消耗的周期
   - 目标：12月达到8,000单位库存

3. **人力资源规划**
   - 分阶段招聘，达到397人峰值
   - 合同设计：长期合同（避免裁员）

### 中期（3-6个月）

1. **参数验证**
   - 验证35%销售增长假设
   - 验证6%需求拉动假设
   - 根据实际调整模型参数

2. **产品线扩展**
   - 对不同产品线分别优化
   - 可能有不同的价格敏感性

3. **竞争响应**
   - 监控竞争对手的反应
   - 可能需要调整折扣幅度

### 长期（6-12个月）

1. **动态定价**
   - 从固定5%折扣→动态折扣
   - 根据库存和需求动态调整

2. **供应链优化**
   - 与外包商谈判改进条款
   - 考虑采购成本变化

3. **模型优化**
   - 加入新约束（最少批量、设置成本等）
   - 考虑产品生命周期影响

---

## 技术细节

### Gurobi求解器配置

```python
m = gp.Model()
m.setParam('OutputFlag', 1)        # 显示求解过程
m.setParam('MIPGap', 0.0001)       # 相对间隙容差
m.setParam('TimeLimit', 300)       # 300秒时间限制
```

### 模型规模信息

```
模型大小：
  行（约束）：108
  列（变量）：120
  非零元素：293

变量类型：
  连续：72个
  整数：36个
  二进制：12个

问题类型：
  线性MIP（混整数规划）
```

---

## 数学验证清单

- [x] 约束条件的可行性
- [x] 目标函数的凸性分析
- [x] 最优解的理论界
- [x] 非连续约束的强度验证
- [x] 路径图独立集理论验证
- [x] 求解间隙分析（0.0007%）
- [x] 边界条件检验

---

## 文件输出结构

```
/Users/angli/Downloads/scm/
├── question_8_9_promotion_optimization.py    [核心代码]
├── Q8_Q9_Mathematical_Modeling_MIP.md        [详细建模文档]
├── README_Q8_Q9_Summary.md                   [本文件]
└── Voluntary Group Work Assignment.pdf       [原始问题陈述]
```

---

## 结论

通过从枚举法升级到混整数规划方法，我们：

1. **数学严密性提升**：从组合搜索→真正的优化求解
2. **计算效率提升**：从363个模型→1个模型（时间从600s→0.02s）
3. **解质量提升**：多促销方案利润增益€3.14M vs 单促销€0.83M（380%改进）
4. **可扩展性提升**：易于添加新约束和目标

**最终建议**：VeloMotion应采用每隔一个月进行一次促销的策略，重点关注偶数月，预期年度利润可增加€3.14M。
